<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnTrack Systems - Monitoramento de Bilhetagem</title>

    <link rel="stylesheet" href="css/estilo-alerta.css">
    <link rel="stylesheet" href="css/estilo-padrao.css">

    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="js/dashboardChamados.js"></script>

</head>

<body>

    <div class="container-dashboard">

        <header class="cabecalho-principal">
            <div class="logo-area">
                <h1>OnTrack <span style="font-weight: 300;">Systems - Chamados</span> </h1>
                <h1><span>Última atualizacao: <span id="ultimaAtt">Carregando...</span></span></h1>
            </div>
        </header>

        <section class="grade-indicadores">
            <div class="card-padrao">
                <div class="titulo-indicador">MTTR (Tempo Médio de Reparo)</div>
                <div class="valor-indicador" id="valorMTTR">12m 30s</div>
                <div class="sub-indicador status-text-green">↓ 15% mais rápido que ontem</div>
            </div>

            <div class="card-padrao">
                <div class="titulo-indicador">Média Semanal de Alertas</div>
                <div class="valor-indicador">142</div>
                <div class="sub-indicador">Alertas registrados nos últimos 7 dias</div>
            </div>

            <div class="card-padrao">
                <div class="titulo-indicador">Alertas Críticos Ativos</div>
                <!-- Este valor agora será fixo baseado nos chamados abertos -->
                <div class="valor-indicador status-text-red" id="indicadorCritico">0</div>
                <div class="sub-indicador">Ação imediata necessária</div>
            </div>
        </section>

        <section class="secao-graficos">

            <div class="card-padrao">
                <div class="titulo-grafico">Alertas por Categoria</div>

                <div class="linha-categoria">
                    <div class="cabecalho-cat">
                        <span><strong>CPU</strong> (Processamento)</span>
                        <span>55% dos alertas</span>
                    </div>
                    <div class="fundo-progresso">
                        <div class="preenchimento-progresso status-bg-red" style="width: 55%;"></div>
                    </div>
                    <p style="font-size: 0.75rem; margin-top: 2px; opacity: 0.7;">Incidentes recorrentes de 'High Load'
                    </p>
                </div>

                <div class="linha-categoria">
                    <div class="cabecalho-cat">
                        <span><strong>Memória RAM</strong></span>
                        <span>30% dos alertas</span>
                    </div>
                    <div class="fundo-progresso">
                        <div class="preenchimento-progresso status-bg-yellow" style="width: 30%;"></div>
                    </div>
                </div>

                <div class="linha-categoria">
                    <div class="cabecalho-cat">
                        <span><strong>Disco / Storage</strong></span>
                        <span>15% dos alertas</span>
                    </div>
                    <div class="fundo-progresso">
                        <div class="preenchimento-progresso status-bg-blue" style="width: 15%;"></div>
                    </div>
                </div>
            </div>

            <div class="card-padrao">
                <div class="titulo-grafico">Severidade Atual</div>
                <p style="font-size: 0.8rem; margin-bottom: 15px; opacity: 0.7;">Classificação dos incidentes ativos (Tempo Real)</p>
                <div class="container-severidade">
                    <div class="estatistica-donut">
                        <div class="indicador-circulo border-status-red status-text-red" id="bolaCrit">0</div>
                        <span>Crítico</span>
                    </div>
                    <div class="estatistica-donut">
                        <div class="indicador-circulo border-status-yellow status-text-yellow" id="bolaMed">0</div>
                        <span>Atenção</span>
                    </div>
                    <div class="estatistica-donut">
                        <div class="indicador-circulo border-status-green status-text-green">--</div>
                        <span>Info</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="secao-tabela">
            <div class="titulo-grafico">Detalhamento dos Incidentes</div>

            <div class="barra-filtros">
                <!-- NOVO FILTRO: DATASET (GERAL vs ABERTOS) -->
                <select id="filtro-dataset" style="border: 2px solid #007bff; font-weight: bold;">
                    <option value="geral">Visualizar: Todos (Histórico Geral)</option>
                    <option value="abertos">Visualizar: Apenas Abertos</option>
                </select>

                <select id="filtro-severidade">
                    <option value="todos">Severidade: Todas</option>
                    <option value="critico">Crítico</option>
                    <option value="atencao">Atenção</option>
                    <option value="info">Informativo</option>
                </select>

                <select id="filtro-categoria">
                    <option value="todos">Categoria: Todas</option>
                    <option value="cpu">CPU</option>
                    <option value="ram">RAM</option>
                    <option value="disco">Disco</option>
                </select>

                <select id="filtro-garagem">
                    <option value="todos" selected>Local: Todos</option>
                </select>

                <button id="btn-limpar" class="btn-reset">Limpar Filtros</button>
            </div>

            <div style="overflow-x: auto;">
                <table id="tabela-alertas">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Status</th> 
                            <th>Severidade</th>
                            <th>Local</th>
                            <th>Categoria</th>
                            <th>Mensagem</th>
                            <th>Data</th> 
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaFiller">
                        <!-- Preenchido via JS -->
                    </tbody>
                </table>
                <div id="msg-sem-resultados" style="display:none; text-align:center; padding: 20px; color: #666;">
                    Nenhum alerta encontrado com os filtros selecionados.
                </div>
            </div>
        </section>

        <section style="margin-bottom: 20px;">
            <div class="card-padrao">
                <div class="titulo-grafico">
                    <span>Comparativo de Incidentes (Semana Atual x Anterior)</span>
                    <span class="status-text-red"
                        style="font-size: 0.8rem; display: flex; align-items: center; gap: 5px;">
                        ↑ Variação Estimada <span style="opacity: 0.5;">| Por Componente</span>
                    </span>
                </div>
                <div id="grafico-comparativo"></div>
            </div>
        </section>
    </div>

    <!-- MODAL DINÂMICO -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-container card-padrao">
            <div class="modal-header">
                <h2>Detalhes do Incidente</h2>
                <button class="fechar-modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- O conteúdo aqui será injetado via JS -->
                <p id="modal-conteudo-dinamico">Carregando...</p>
            </div>
            <div class="modal-footer">
                <button class="btn-acao">Exportar Log</button>
                <button class="btn-reset fechar-modal-btn">Fechar</button>
            </div>
        </div>
    </div>

</body>
</html>

